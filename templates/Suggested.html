<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Suggested Teams</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            background: '#0D1117',
            card: '#161B22',
            primary: '#0F62FE',
            danger: '#DC2626'
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif']
          }
        }
      }
    };
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-background text-white font-sans min-h-screen flex flex-col">

  <header class="flex items-center justify-between p-4 bg-card border-b border-gray-700 shadow-md">
    <div class="text-xl font-bold">Suggested Teams</div>
    <button id="logoutBtn" class="ml-4 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm">Logout</button>
  </header>

  <div class="flex flex-1">
    <aside class="w-64 bg-card border-r border-gray-700 hidden md:block">
      <nav class="mt-6 px-6 space-y-4">
        <a href="/manager" class="block text-sm hover:text-primary">Dashboard</a>
        <a href="#" class="block text-sm text-blue-500 font-medium">Suggestion</a>
        <a href="/approved" class="block text-sm hover:text-primary">Approved Employees</a>
      </nav>
    </aside>

    <main class="flex-1 p-6 bg-background rounded-2xl shadow-md">
      <div id="setContainer" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-8"></div>
    </main>
  </div>

  <!-- Modal -->
  <div id="successModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
    <div class="bg-card p-8 rounded-xl shadow-lg text-center w-80">
      <svg class="w-16 h-16 text-green-500 mx-auto mb-4" viewBox="0 0 52 52">
        <circle class="tick-circle" cx="26" cy="26" r="25" fill="none" stroke="currentColor" stroke-width="3"/>
        <path class="tick-mark" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" d="M14 27l8 8 16-16"/>
      </svg>
      <h2 class="text-white font-semibold text-xl mb-2">Set Selected!</h2>
      <p class="text-gray-400">Redirecting to approved set...</p>
    </div>
  </div>

  <script>
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('loggedInUser');
      window.location.href = '/';
    });

    const rawSets = JSON.parse(localStorage.getItem("suggestionResults") || "[]");

    const sets = rawSets.map((group, i) => ({
      name: `Set ${i + 1}`,
      score: Math.round(group.average_similarity * 100),
      employees: group.employees.map(name => ({
        name,
        isOutlier: name === group.outlier_employee
      })),
      outlier: group.outlier_employee || null
    }));

    let selectedSetIndex = null;

    function renderSets() {
      const container = document.getElementById('setContainer');
      container.innerHTML = '';

      sets.forEach((set, index) => {
        const card = document.createElement('div');
        card.className = `bg-card border rounded-xl shadow-lg p-4 transition-transform hover:scale-105 ${selectedSetIndex === index ? 'border-green-500' : 'border-gray-700'}`;

        card.innerHTML = `
          <h3 class="text-white font-semibold text-center mb-4">${set.name} </h3>
          ${set.outlier ? `<p class="text-sm text-red-400 text-center mb-2">Outlier: ${set.outlier}</p>` : ''}
          <div class="overflow-x-auto">
            <table class="w-full table-auto text-left text-white">
              <thead>
                <tr class="text-sm text-gray-400 border-b border-gray-700">
                  <th class="py-2 px-4">Name</th>
                  <th class="py-2 px-4 text-center">Score</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="p-0" colspan="2">
                    <table class="w-full">
                      <tbody>
                        ${set.employees.map((emp, i) => `
                          <tr class="${emp.isOutlier ? 'bg-yellow-900/50' : 'bg-gray-800'}">
                            <td class="py-3 px-4">${emp.name}</td>
                            ${i === 0 ? `<td class="py-3 px-4 text-center align-middle" rowspan="${set.employees.length}">${set.score}%</td>` : ''}
                          </tr>
                        `).join('')}
                      </tbody>
                    </table>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="flex justify-center mt-4">
            <button class="select-btn w-full  bg-green-600 hover:bg-green-700 text-white py-2 px-8 rounded-lg"
  onclick="selectSet(${index})"
  ${selectedSetIndex !== null && selectedSetIndex !== index ? 'disabled class="opacity-50 cursor-not-allowed"' : ''}>
  ${selectedSetIndex === index ? 'Set Selected' : 'Choose Set'}
</button>

          </div>
        `;

        container.appendChild(card);
      });
    }

    function selectSet(index) {
      if (selectedSetIndex !== null) return;
      selectedSetIndex = index;
      const modal = document.getElementById("successModal");
      modal.classList.remove("hidden");

      const selectedSet = sets[selectedSetIndex];
      localStorage.setItem("approvedSet", JSON.stringify(selectedSet));

      setTimeout(() => {
        modal.classList.add("hidden");
        window.location.href = "/approved";
      }, 2500);
    }

    renderSets();
  </script>
</body>
</html>
